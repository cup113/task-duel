# Task Duel 项目开发文档

***本项目使用 pnpm 包管理器！！！***

## 1. 项目概述

**Task Duel** 是一个实时竞争型任务管理应用，旨在通过多人协作和实时进度对比提升用户完成作业或任务的积极性。

### 核心功能

- **房间管理**：用户可以创建或加入房间，房主可设置任务。
- **任务拆分**：任务可拆分为多个子任务，所有成员必须完成所有子任务。
- **实时进度对比**：用户完成任务时点击标记，界面实时显示其他成员的进度。
- **用户管理**：用户注册、登录、个人信息管理。（默认游客模式，浏览器端生成一个 fake email `${nanoid()}@guest.com` 及密码，在浏览器 localStorage 保存）

### 技术栈

- **前端**（当前目录）：Vue 3 + TypeScript + Pinia/Vuex
- **后端**（`./server`）：Node.js (Express/NestJS) + PocketBase（数据库）
- **实时通信**：SSE
- **数据库**（`./server/db`）：PocketBase

## 2. 数据库结构

基于提供的 PocketBase 类型定义，数据库主要表结构如下：

### 核心表

| 表名             | 字段                                            | 说明         |
| ---------------- | ----------------------------------------------- | ------------ |
| **`users`**      | `id`, `name`, `email`, `password`, `tokenKey`   | 用户信息     |
| **`rooms`**      | `id`, `code`, `name`, `owner`, `participants[]` | 房间信息     |
| **`tasks`**      | `id`, `room`, `title`                           | 任务信息     |
| **`subtasks`**   | `id`, `task`, `title`, `order`, `completion[]`  | 子任务信息   |
| **`completion`** | `id`, `user`, `progress`                        | 用户完成进度 |

### 关系说明

- **`rooms.owner`** → `users`（房主）
- **`rooms.participants`** → `users[]`（房间成员）
- **`tasks.room`** → `rooms`（任务所属房间）
- **`subtasks.task`** → `tasks`（子任务所属任务）
- **`subtasks.completion`** → `completion[]`（子任务完成记录）
- **`completion.user`** → `users`（完成任务的用户）

## 3. 前端架构

### 页面结构

1. **登录/注册页**
2. **房间列表页**（可创建/加入房间）
3. **房间详情页**（显示任务、子任务、实时进度）

### 核心设计

1. 创建子任务
   - 批量导入，一行一个
   - 由于作业很多以题号呈现，如果一行形如“3~8”，则创建 3,4,5,6,7,8 子任务
   - 对于一些常见的 pattern 可以保存在本地
2. 子任务实时进度显示
   - 类似表格，每一行显示一个子任务
   - 第一列是主按钮，单击完成/撤销，长按调整进度
   - 后面每一列显示房间内另外一个成员的完成情况，包括“-”（未开始），“xx%”（进行中），“mm:ss”（已完成，完成时间）

### 第三方库

- 状态管理：Pinia
- 样式：Tailwind CSS / Reka UI（UI 组件抽离至 components/ui 目录下）

## 待处理内容

- [ ] 后端鉴权
- [ ] 后端日志系统（进行中）
- [ ] 后端类型系统
- [ ] 跨端类型系统
- [ ] 前端组件架构
